"use strict";(self.webpackChunkluban_docs=self.webpackChunkluban_docs||[]).push([[1844],{5991:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>a,frontMatter:()=>s,metadata:()=>l,toc:()=>c});var t=o(4848),i=o(8453);const s={sidebar_position:4},r="Workflow for Robot",l={id:"getting-started/workflow-for-robot/index",title:"Workflow for Robot",description:'In the previous workflow, we built a simple "Hello World" sequence. In this section, we will develop a more complex workflow where a humanoid robot listens, thinks, speaks, and acts.',source:"@site/docs/4-getting-started/4-workflow-for-robot/index.mdx",sourceDirName:"4-getting-started/4-workflow-for-robot",slug:"/getting-started/workflow-for-robot/",permalink:"/docs/getting-started/workflow-for-robot/",draft:!1,unlisted:!1,editUrl:"https://github.com/tiwater/luban-docs/edit/main/docs/4-getting-started/4-workflow-for-robot/index.mdx",tags:[],version:"current",lastUpdatedBy:"Sawyer",lastUpdatedAt:1719587108e3,sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"defaultSidebar",previous:{title:"First Workflow",permalink:"/docs/getting-started/first-workflow/"},next:{title:"Deploy to Robot",permalink:"/docs/getting-started/deployment/"}},d={},c=[{value:"Workflow Overview",id:"workflow-overview",level:2},{value:"Build Workflow",id:"build-workflow",level:2},{value:"Test Workflow with Simulation",id:"test-workflow-with-simulation",level:2},{value:"Next Steps",id:"next-steps",level:2}];function h(e){const n={code:"code",h1:"h1",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"workflow-for-robot",children:"Workflow for Robot"}),"\n",(0,t.jsx)(n.p,{children:'In the previous workflow, we built a simple "Hello World" sequence. In this section, we will develop a more complex workflow where a humanoid robot listens, thinks, speaks, and acts.'}),"\n",(0,t.jsx)(n.h2,{id:"workflow-overview",children:"Workflow Overview"}),"\n",(0,t.jsx)(n.p,{children:"The workflow consists of the following steps:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Start"}),": Begin with initialization for the simulation."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"ASR"}),": An Automatic Speech Recognition node acts as a trigger node."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Event Loop"}),": Event loop listens for events triggered by ASR."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Event Processing"}),": Handles the received events accordingly. In this example, it provides a response to the user's question using an LLM and executes fixed actions: move forward for two seconds and then move backward for two seconds."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"build-workflow",children:"Build Workflow"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Create New Project"}),": Click the ",(0,t.jsx)(n.code,{children:"New Project"})," button to create a new project."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Edit Project Description"}),": Click the pop-up menu at the bottom of the editing area, select ",(0,t.jsx)(n.code,{children:"Edit Description"}),", and customize the project description as needed.\n",(0,t.jsx)(n.img,{alt:"Edit Description",src:o(6234).A+"",width:"811",height:"603"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Add Nodes"}),": Follow the steps below to add the corresponding nodes to the workflow and configure them as necessary:","\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Initialization"}),"\uff1aAdd the nodes below:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Humanoid Robot Node"})," (Robot Control): Represents the robot entity, configuring the robot's IP for control."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Boolean Input Node"})," (Input & Output): Determines whether the workflow runs on the real robot or in simulation.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Select the Boolean Input Node, press the ",(0,t.jsx)(n.code,{children:"Configure the node"})," button in the Property Pane, change the ",(0,t.jsx)(n.code,{children:"Instance id"})," to ",(0,t.jsx)(n.code,{children:"simulationControl"}),", and click ",(0,t.jsx)(n.code,{children:"Confirm"})," button.\n",(0,t.jsx)(n.img,{alt:"Config Boolean Input",src:o(669).A+"",width:"650",height:"479"}),"\n",(0,t.jsx)(n.img,{alt:"Name Simulation Control",src:o(9048).A+"",width:"882",height:"393"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"If Node"})," (Logic Control): Controls the initialization process. Drag the following nodes into the True block of the If Node:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Start Control Server Node"})," (Robot Management): Starts the robot control service."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Start Node"})," (Robot Control): Initializes the robot driver."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Delay Node"})," (Programming): Waits for initialization completion."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Stand Node"})," (Robot Control): Commands the robot to stand."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Delay Node"})," (Programming): Waits for the robot to complete standing."]}),"\n",(0,t.jsx)(n.li,{children:"For both Delay Nodes, input 5000 in the Time box in the Property Pane, indicating a 5-second delay (5000ms) to wait for command completion."}),"\n",(0,t.jsx)(n.li,{children:"Connect the nodes in the True block of the If Node sequentially with the brown Trigger connections to define execution order."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Use brown Trigger connections to link the Humanoid Robot Node, Boolean Input Node, and If Block sequentially."}),"\n",(0,t.jsxs)(n.li,{children:["Connect the pink endpoints of the Boolean Input Node (simulationControl) and the If Node to pass the simulationControl boolean value as an input for conditional judgment.\nThe current workflow should resemble the diagram below:\n",(0,t.jsx)(n.img,{alt:"Workflow phase 1",src:o(2096).A+"",width:"1307",height:"436"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Configure Variables"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Click the pop-up menu at the bottom of the editing area, select ",(0,t.jsx)(n.code,{children:"Define variables"}),", input ",(0,t.jsx)(n.code,{children:"events"}),", and click the ",(0,t.jsx)(n.code,{children:"+"})," button, creating a variable for event queue."]}),"\n",(0,t.jsxs)(n.li,{children:["Then input ",(0,t.jsx)(n.code,{children:"event"})," and click the ",(0,t.jsx)(n.code,{children:"+"})," button, which will hold the current event being processed."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Trigger"}),": Add the nodes below:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Let Node"})," (Programming): Assigns a value to a variable. In the Property Pane, select ",(0,t.jsx)(n.code,{children:"events"})," in the ",(0,t.jsx)(n.code,{children:"Variable"})," field and input ",(0,t.jsx)(n.code,{children:"[]"})," in the ",(0,t.jsx)(n.code,{children:"Value"})," field to initialize events as an empty array.\n",(0,t.jsx)(n.img,{alt:"Let",src:o(8072).A+"",width:"531",height:"489"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"ASR Node"})," (Interaction): Automatic Speech Recognition converts speech to text, triggering robot actions. Add the following nodes to the ASR block:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"For Each Node"})," (Logic Control): Iterates over the ASR output event array, processing each element. Add the following node to the For Each block:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Add Array Element Node"})," (Programming): Adds elements to the array. Input ",(0,t.jsx)(n.code,{children:"events"})," in the ",(0,t.jsx)(n.code,{children:"Input Array"})," field to append the received object to the end of events."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Connect the Let, ASR, For Each, and Add Array Element nodes sequentially using the same color input-output ports, as shown below:\n",(0,t.jsx)(n.img,{alt:"ASR",src:o(2597).A+"",width:"750",height:"280"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Main Message Loop"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"While Node"})," (Logic Control): Select the While Node, input ",(0,t.jsx)(n.code,{children:"true"})," in the ",(0,t.jsx)(n.code,{children:"Condition"})," field of the Property Pane to create an infinite loop for the main message loop.\n",(0,t.jsx)(n.img,{alt:"While Loop",src:o(4903).A+"",width:"822",height:"328"}),"\nAdd the following nodes to the While block:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"While Node"}),": Select the inner While Node, input ",(0,t.jsx)(n.code,{children:"events.length>0"})," in the ",(0,t.jsx)(n.code,{children:"Condition"})," field of the Property Pane. This follows JavaScript syntax, processing events when the queue is not empty."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Delay Node"})," (Programming): Input 100 in the Time field."]}),"\n",(0,t.jsxs)(n.li,{children:["Connect the nodes in the inner While block to the outer While Node and the Delay Node as shown below:\n",(0,t.jsx)(n.img,{alt:"Event Loop 1",src:o(8038).A+"",width:"755",height:"305"})]}),"\n",(0,t.jsxs)(n.li,{children:["Add the following nodes to the inner While block:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Get Array Element Node"})," (Programming): Takes elements from the array. Input ",(0,t.jsx)(n.code,{children:"events"})," in the ",(0,t.jsx)(n.code,{children:"Input Array"})," field and check the ",(0,t.jsx)(n.code,{children:"Remove"})," box to remove processed events."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Let Node"})," (Programming): Assigns values to variables. In the Property Pane, select ",(0,t.jsx)(n.code,{children:"event"})," in the ",(0,t.jsx)(n.code,{children:"Variable"})," field."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Switch Node"})," (Logic Control): Handles messages, triggering different logic based on message type. Select the Switch Node, input ",(0,t.jsx)(n.code,{children:"event.name"})," in the ",(0,t.jsx)(n.code,{children:"Condition"})," field, and input ",(0,t.jsx)(n.code,{children:"asr"})," in Case 1. If the event's name is asr, it triggers the logic in Case 1."]}),"\n",(0,t.jsxs)(n.li,{children:["Connect the inner While Node with the Get Array Element Node, Let Node, and Switch Block sequentially as shown below:\n",(0,t.jsx)(n.img,{alt:"Event Loop 2",src:o(9805).A+"",width:"913",height:"749"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Add the following nodes to the Case 1 block of the Switch:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"LLM Node"})," (AI): Large Language Model handles the user's text input. Enable the ",(0,t.jsx)(n.code,{children:"Exp"})," option next to ",(0,t.jsx)(n.code,{children:"Question"})," and input ",(0,t.jsx)(n.code,{children:"event.parameters.text"})," in ",(0,t.jsx)(n.code,{children:"Question"})," to allow the LLM to respond to the ASR Node\u2019s recognized text. Adjust System Context as needed.\n",(0,t.jsx)(n.img,{alt:"LLM",src:o(5786).A+"",width:"384",height:"818"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Text To Speech Node"})," (Interaction): Converts text to speech allowing the robot to vocalize the LLM's response. Customize the voice, speed, etc."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Walk Node"})," (Robot Control): Controls the robot's movement."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Delay Node"})," (Programming): Waits for the robot to move. Set Time to 2000 (2 seconds)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Walk Node"})," (Robot Control): Moves the robot with ",(0,t.jsx)(n.code,{children:"Speed"})," set to -0.1 (backward motion)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Delay Node"})," (Programming): Waits for the robot to move. Set Time to 2000 (2 seconds)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Stand Node"})," (Robot Control): Commands the robot to stand."]}),"\n",(0,t.jsxs)(n.li,{children:["Connect the nodes as illustrated below:\n",(0,t.jsx)(n.img,{alt:"Event Loop 3",src:o(6564).A+"",width:"1260",height:"979"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Simulation Trigger"}),"\uff1a","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"To test robot movements in the simulation since ASR Node cannot run in a simulated environment, let's simulate the trigger condition. Add the following nodes to the workflow:"}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"If Node"})," (Logic Control): Add the following nodes to the True block of the If Node:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Let Node"})," (Programming): Assigns values to variables. In the Property Pane, select ",(0,t.jsx)(n.code,{children:"events"})," in the ",(0,t.jsx)(n.code,{children:"Variable"})," field and input ",(0,t.jsx)(n.code,{children:'[{"name":"asr","parameters":{"text":"Hi, nice to meet you!"}}]'})," in the ",(0,t.jsx)(n.code,{children:"Value"})," field to simulate ASR detecting human conversation."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Final Assembly"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Connect the node groups created in previous steps in approximately the following sequence: i -> iii -> iv -> v using brown Trigger connections."}),"\n",(0,t.jsxs)(n.li,{children:["Note: Connect the If block of the group v to the Let Node of the group iii; connect the pink input port of the If Node in the group v to the output port of the Boolean Input in the group i. The final setup should look like this:\n",(0,t.jsx)(n.img,{alt:"Complete",src:o(6674).A+"",width:"1730",height:"1659"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"test-workflow-with-simulation",children:"Test Workflow with Simulation"}),"\n",(0,t.jsx)(n.p,{children:"Simulation is an important feature for robot development. It allows you to test your workflow without deploying it to the robot. You can see how the robot moves and interacts with its environment in real-time. It's not only convenient but also safe. Sometimes flawed program can cause damages to the robot, simulation can help you avoid this risk. Or unexpected robot behavior will cause accident such as hurting people, simulation can help you avoid this risk."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Config Workflow for Simulation"}),": Select the ",(0,t.jsx)(n.code,{children:"simulationControl"})," (Boolean Input) node, check the ",(0,t.jsx)(n.code,{children:"Data"})," option in the ",(0,t.jsx)(n.code,{children:"Properties Pane"})," enabling the workflow to execute the simulation branch."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Enable Simulation"}),": Click the ",(0,t.jsx)(n.code,{children:"Simulation"})," tab in the ",(0,t.jsx)(n.code,{children:"Properties Pane"})," to enable the simulation feature, and then click the ",(0,t.jsx)(n.strong,{children:"Turn on simulation"})," button to start the simulation. Please wait for a moment, the simulation environment will be loaded."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Run Workflow"}),": Click the ",(0,t.jsx)(n.code,{children:"Run"})," button to run the workflow in the simulation environment. You will see the robot moving forward and backward in the simulation."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Since the simulation doesn't support interactive features beyond movement, only basic robot movements are visible. In a real environment, the robot moves as expected and can listen and talk. Testing these features on the real robot is safe and straightforward."}),"\n",(0,t.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsx)(n.p,{children:"Now we have a workflow that commands the robot to move forward and backward. In the next section, we will deploy the workflow to the robot and run it in a production environment."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Note"}),":\nBefore executing on the robot, deselect the ",(0,t.jsx)(n.code,{children:"Data"})," option of the ",(0,t.jsx)(n.code,{children:"simulationControl"})," (Boolean Input) node."]})]})}function a(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},2597:(e,n,o)=>{o.d(n,{A:()=>t});const t=o.p+"assets/images/asr-ddf4946be27b524ffd3bfac82d984bd9.png"},6674:(e,n,o)=>{o.d(n,{A:()=>t});const t=o.p+"assets/images/complete-ff9a1eaac966368a080890a99f40ff71.png"},669:(e,n,o)=>{o.d(n,{A:()=>t});const t=o.p+"assets/images/config-boolean-input-c560483f8cbe6097603da9fee0fcac8c.png"},6234:(e,n,o)=>{o.d(n,{A:()=>t});const t=o.p+"assets/images/edit-description-fd7881b49690bb82f513dd82ee95a905.png"},8038:(e,n,o)=>{o.d(n,{A:()=>t});const t=o.p+"assets/images/event-loop-1-12a4b60f6bd4f590333229f32b1785f8.png"},9805:(e,n,o)=>{o.d(n,{A:()=>t});const t=o.p+"assets/images/event-loop-2-668c0b0a71a4ec7edb2bd79215e6fd88.png"},6564:(e,n,o)=>{o.d(n,{A:()=>t});const t=o.p+"assets/images/event-loop-3-b071444e25a4afe8e35a0c12d71ceed9.png"},8072:(e,n,o)=>{o.d(n,{A:()=>t});const t=o.p+"assets/images/let-53ffc2a24e67a63006c52252ca0b798c.png"},5786:(e,n,o)=>{o.d(n,{A:()=>t});const t=o.p+"assets/images/llm-7f97526aab3bbddce3854ff739b2a622.png"},9048:(e,n,o)=>{o.d(n,{A:()=>t});const t=o.p+"assets/images/name-simulation-control-e52a7a9627cc7244b5712bdd70ff8977.png"},2096:(e,n,o)=>{o.d(n,{A:()=>t});const t=o.p+"assets/images/phase-1-d57cfe7a9ece089c5af13d4ec64ad867.png"},4903:(e,n,o)=>{o.d(n,{A:()=>t});const t=o.p+"assets/images/while-true-ad38f66f3994b86078b89e253a169c62.png"},8453:(e,n,o)=>{o.d(n,{R:()=>r,x:()=>l});var t=o(6540);const i={},s=t.createContext(i);function r(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);